# 软件需求规格说明

**项目名称：软件可靠性分析平台**  
**版本：V1.0**  
**日期：2025-12-15**  
**编制：研发团队**  
**审核：—**  
**批准：—**

<div style="page-break-after: always;"></div>

## 版本修订记录
| 版本 | 日期 | 作者 | 审核 | 批准 | 变更说明 |
| --- | --- | --- | --- | --- | --- |
| V1.0 | 2025-12-15 | 团队 | — | — | 首次编制，基于当前实现 |

## 分发记录
| 分发对象 | 职责 | 日期 | 备注 |
| --- | --- | --- | --- |
| 项目组全体 | 研发/测试/运维 | 2025-12-15 | 内部共享 |
| 业务方代表 | 评审/验收 | 2025-12-15 | 仅供审阅 |

<div style="page-break-after: always;"></div>

## 目录
1. 范围  
&emsp;1.1 标识  
&emsp;1.2 系统概述  
&emsp;1.3 文档概述  
2. 引用文档  
3. 需求  
&emsp;3.1 要求的状态和方式  
&emsp;3.2 CSCI能力需求  
&emsp;&emsp;3.2.1 CSCI能力（示例：数据导入/分析）  
&emsp;3.3 CSCI外部接口需求  
&emsp;&emsp;3.3.1 接口标识和接口图  
&emsp;&emsp;3.3.2 外部接口标识  
&emsp;&emsp;3.3.3 外部接口元素说明  
&emsp;3.4 CSCI内部接口需求  
&emsp;3.5 CSCI内部数据需求  
&emsp;3.6 界面要求  
&emsp;3.7 适应性需求  
&emsp;3.8 安全性需求  
&emsp;3.9 保密性需求  
&emsp;3.10 CSCI环境需求  
&emsp;3.11 计算机资源需求  
&emsp;&emsp;3.11.1 计算机硬件需求  
&emsp;&emsp;3.11.2 计算机硬件资源使用需求  
&emsp;&emsp;3.11.3 计算机软件需求  
&emsp;&emsp;3.11.4 计算机通信需求  
&emsp;3.12 软件质量因素  
&emsp;3.13 设计和实现约束  
&emsp;3.14 人员需求  
&emsp;3.15 培训需求  
&emsp;3.16 软件保障需求  
&emsp;3.17 其他需求  
&emsp;3.18 验收、交付和包装需求  
&emsp;3.19 需求的优先顺序和关键程度  
4. 用例  
&emsp;4.1 主要用例列表  
&emsp;4.2 用例流程  
&emsp;4.3 用例图  
5. 合格性规定  
6. 需求可追踪性  
7. 注释

<div style="page-break-after: always;"></div>

## 1 范围
### 1.1 标识
- 标识号：SR-SPR-2025-RP  
- 标题：软件可靠性分析平台  
- 缩略名：SRP  
- 版本号：V1.0  
- 适用系统：软件可靠性分析平台（本地/内网部署）

### 1.2 系统概述
用于导入失效相关数据（手动/CSV/Excel/MySQL/智能映射），运行经典可靠性模型、轻量 AI 模型、时间序列预测、组合加权与 SDA 场景分析，输出图表、公式与报表（HTML/PDF），并支持 Cloudflare Worker 的用户管理。

### 1.3 文档概述
规定平台的软件需求（功能、接口、数据、安全、性能等），为概要设计、详细设计、测试与验收提供输入。

## 2 引用文档
- `docs/requirements.md`  
- `docs/test-report.md`  
- `.env.example`、`requirements.txt`  
- `软件概要设计说明.md`、`软件用户手册.md`  
- `用户管理流程.md`

## 3 需求
### 3.1 要求的状态和方式
- 状态/方式：待导入、映射确认、导入成功/失败、待分析、分析中、分析完成、导出。  
- 系统结构示意：
![](系统结构示意.png)

### 3.2 CSCI能力需求
#### 3.2.1 CSCI能力
- 数据导入能力：手动录入、CSV/Excel 上传预览、MySQL 预览与导入；提供本地映射或 DeepSeek 映射；非法文件/列名需报错。
- 列映射能力：本地映射（用户指定 module/failures/mtbf/runtime），DeepSeek 智能映射（失败回退本地），映射结果需确认后写入。
- 经典模型分析能力：Goel-Okumoto、Jelinski-Moranda、Musa-Okumoto、Crow-AMSAA、Duane，输出参数、曲线、公式（MathJax），按需点击“开始分析”。
- AI 模型分析能力：BPN、RBF、线性 SVM、GEP 轻量训练，输出预测 vs 实际、RMSE、权重/中心/多项式系数，样本不足时降级基线。
- 时间序列分析能力：ARIMA 近似、Holt-Winters 平滑，输出短期预测与平滑序列，按需触发。
- 组合加权与 SDA 能力：动态/静态权重曲线平衡经典与 AI，SDA 路径可靠度估计，输出路径权重与结果。
- 模型对比能力：PKR/性能等指标对比展示。
- 导出能力：一键导出当前分析结果为 HTML，浏览器打印为 PDF，需保留目录跳转与公式渲染。
- 用户管理能力：调用 Cloudflare Worker `/users` 完成增/查/删；支持配置 `WORKER_ENDPOINT`、`WORKER_AUTH_TOKEN`。

示例用例（文件导入与分析）：
![](文件导入与分析用例图.png)

### 3.3 CSCI外部接口需求
#### 3.3.1 接口标识和接口图
![](接口标识和接口图.png)

#### 3.3.2 外部接口标识
| 序号 | 信源 | 接口标识 | 类型 | 接口功能说明 |
| --- | --- | --- | --- | --- |
| 1 | 浏览器 | /api/import/file | HTTP POST | 上传、映射、入库 |
| 2 | 浏览器 | /api/import/mysql | HTTP POST | 预览后导入 |
| 3 | 平台 | api.deepseek.com | HTTPS POST | 智能映射 |
| 4 | 平台 | <worker>/users | HTTPS GET/POST/DELETE | 增删查 |
| 5 | 平台 | DSN(mysql://…) | TCP | 读表 |

#### 3.3.3 外部接口元素说明
- 数据导入/分析主要数据元素：

| 名称 | 类型 | 约束 | 说明 |
| --- | --- | --- | --- |
| module | string | 非空，长度≤64 | 模块/子系统 |
| failures | int | >=0 | 失效次数 |
| mtbf | float | >=0 | 平均无故障时间 |
| runtime | float | >=0 | 运行时长 |
| timestamp | string | ISO8601 | 时间戳 |
| source | string | 长度≤64，可空 | 数据来源标记 |

- 外部接口通信：HTTPS（DeepSeek/Worker）、HTTP（浏览器到平台）、TCP（MySQL）；JSON 作为载荷格式。

### 3.4 CSCI内部接口需求
- Flask 路由调用：`app.py` 内部调用 `services/reliability.py`、`services/data_store.py`、`services/deepseek.py`。  
- 数据流：路由 → 业务函数 → 内存存储 → 响应 JSON/模板。  
- 内部接口保持模块化，函数输入输出使用 Python 基本类型/字典列表。

### 3.5 CSCI内部数据需求
- 统一记录结构：`{module, failures, mtbf, runtime, timestamp, source}`。  
- 数据清洗：空/非法值需修正或报错；RMSE 计算做裁剪防溢出。  
- 内存存储：线程安全列表；可扩展到数据库。

### 3.6 界面要求
- 左侧导航：数据导入、经典模型、人工智能模型、时间序列、组合加权/SDA、模型对比、系统管理、文档。  
- 数据导入页：上传/预览表格，弹出映射确认窗口（本地/DeepSeek），确认后导入。  
- 各模型区：提供“开始分析”按钮、图表区域、公式展示（MathJax），加载状态提示。

### 3.7 适应性需求
- `.env` 可配置 API Key、DSN、Worker 端点；可切换本地映射/DeepSeek。  
- 支持在内网/单机运行；外部依赖不可用时自动回退。

### 3.8 安全性需求
- 输入校验：列名合法、文件类型/大小检查、DSN 合法性检查。  
- DeepSeek/Worker 仅 HTTPS；错误需明确提示且回退本地逻辑。

### 3.9 保密性需求
- API 密钥仅存 `.env`，不硬编码、不前端暴露；传输使用 HTTPS。  
- 用户数据（Worker）需遵循云端 KV 的访问控制。

### 3.10 CSCI环境需求
- 运行环境：Python 3.9+；浏览器支持 ES6/Fetch；可访问本地文件系统读取上传文件。

### 3.11 计算机资源需求
#### 3.11.1 计算机硬件需求
- 开发/运行：4 核 CPU，8GB RAM，10GB 可用磁盘（含依赖与导出文件）。

#### 3.11.2 计算机硬件资源使用需求
- 常规数据量（< 万行）下 CPU/RAM 占用维持在单机可接受水平；大文件导入需分批或预览后导入。

#### 3.11.3 计算机软件需求
- OS：Windows 10/11（可移植类 Unix）；Python 3.9+；可选 MySQL 客户端。  
- 依赖：`requirements.txt`（Flask、requests、openpyxl、mysql-connector-python 等）。

#### 3.11.4 计算机通信需求
- 外部 HTTPS（DeepSeek、Worker）；MySQL TCP 3306；本地 HTTP 5000。

### 3.12 软件质量因素
- 功能性：覆盖导入、映射、分析、对比、导出、用户管理。  
- 可靠性：异常回退（DeepSeek/Worker、RMSE 溢出、空数据等）。  
- 可用性：按需分析、加载提示、明确错误信息。  
- 可维护性：分层清晰，配置集中，依赖列表化。

### 3.13 设计和实现约束
- 语言/框架：Python + Flask；前端 Chart.js + MathJax。  
- 配置：`.env` 管理密钥/DSN；不得硬编码密钥。  
- 接口：统一 JSON；路径 `/api/<domain>/<action>`。

### 3.14 人员需求
- 常规运维 1-2 人；开发/测试按迭代投入；用户为业务/分析人员。

### 3.15 培训需求
- 提供操作手册/用户手册；短时培训说明导入/映射/分析/导出流程。

### 3.16 软件保障需求
- 建议定期备份 `.env` 与导出结果；外部接口异常时确保回退；日志可扩展存档。

### 3.17 其他需求
- 公式需正确渲染；导出 HTML 经浏览器打印 PDF 保留目录跳转。

### 3.18 验收、交付和包装需求
- 交付内容：源代码、`.env.example`、`requirements.txt`、《软件需求规格说明》《软件概要设计说明》《软件用户手册》、测试报告等。  
- 验收标准：依据本需求文档与 `docs/test-report.md` 覆盖的用例执行通过。

### 3.19 需求的优先顺序和关键程度
- 高：数据导入（手动/文件/MySQL）、本地映射、经典/AI/时间序列/组合/SDA 分析、导出、基础用户管理。  
- 中：DeepSeek 智能映射、Cloudflare Worker 集成、模型对比。  
- 低：界面美化、更多导出格式。

## 4 用例
### 4.1 主要用例列表
| 用例编号 | 名称 | 触发者 | 前置条件 | 后置条件 |
| --- | --- | --- | --- | --- |
| UC01 | 文件导入并分析 | 普通/分析用户 | 文件可读，格式正确 | 数据入库，仪表盘刷新 |
| UC02 | MySQL 导入并分析 | 分析用户 | DSN 正确，表可访问 | 数据入库，仪表盘刷新 |
| UC03 | DeepSeek 映射 | 分析用户 | 配置 API Key，样本可取 | 返回映射并应用或回退 |
| UC04 | 经典/AI/时间序列/组合/SDA 分析 | 分析用户 | 已导入数据 | 输出图表、参数、公式 |
| UC05 | 导出 HTML/PDF | 普通/分析用户 | 已有分析结果 | 生成 HTML，可打印 PDF |
| UC06 | 用户管理 | 管理员 | Worker 可访问 | 增/查/删用户 |

### 4.2 用例流程
#### UC01 文件导入并分析
![](<UC01 文件导入并分析.png>)

#### UC02 MySQL 导入并分析
1) 填写 DSN/表名/limit，调用 `/api/import/mysql/sample` 预览。  
2) 选择映射（本地/DeepSeek），确认后调用 `/api/import/mysql` 导入。  
3) 导入成功后，用户在各板块点击“开始分析”。  

#### UC03 DeepSeek 映射
1) 文件/MySQL 预览后选择“DeepSeek 分析”。  
2) 后端调用 DeepSeek 返回映射；失败/超时回退本地映射。  
3) 用户确认映射结果并导入。  

#### UC04 模型分析
1) 数据导入成功后，点击对应板块“开始分析”。  
2) 后端 `/api/analyze/<section>` 调度模型计算，返回 datasets+公式。  
3) 前端 Chart.js 渲染图表，MathJax 渲染公式。  

#### UC05 导出 HTML/PDF
1) 前端触发导出，后端生成含图表/公式的 HTML。  
2) 浏览器打开 HTML，打印为 PDF，保留目录跳转。  

#### UC06 用户管理
1) 填写姓名/角色/邮箱/状态，调用 `/api/users`（POST）同步至 Worker。  
2) 用户列表调用 `/api/users`（GET）从 Worker 拉取。  
3) 删除通过 Worker `DELETE /users/<id>`（当前用命令/API 工具）。  

### 4.3 用例图
![](用例图.png)

## 5 合格性规定
- 演示：前端操作演示导入→映射→分析→导出；用户增删。  
- 测试：REST 接口调用（/api/import/*、/api/analyze/<section>、/api/users），对照 `docs/test-report.md`。  
- 分析：检查 RMSE/权重/曲线输出是否与样本数据量级一致；异常场景回退行为。  
- 审查：代码与文档静态检查（配置、密钥管理、错误处理）。  
- 特殊：DeepSeek/Worker 在离线场景需验证回退路径。

## 6 需求可追踪性
- 本 CSCS 需求与系统需求的对应：  
  - 导入/映射/分析/导出 → 满足可靠性分析的核心业务需求。  
  - 用户管理 → 满足角色与人员管理需求。  
- 需求到系统/模块的映射见下表：

| 需求名称 | 标识 | 章条号 | 模块/接口 | 说明 |
| --- | --- | --- | --- | --- |
| 文件导入 | REQ-IMP-FILE | 3.2.1 | /api/import/file | 上传、预览、映射、导入 |
| MySQL 导入 | REQ-IMP-DB | 3.2.1 | /api/import/mysql | 预览、映射、导入 |
| 智能映射 | REQ-MAP-AI | 3.2.1 | /api/deepseek/mapping | 调用 DeepSeek，失败回退 |
| 模型分析 | REQ-ANALYZE | 3.2.1 | /api/analyze/<section> | 经典/AI/时间序列/组合/SDA |
| 模型对比 | REQ-COMPARE | 3.2.1 | /api/analyze/compare | PKR/性能对比 |
| 导出 | REQ-EXPORT | 3.2.1 | 内置导出 | 导出 HTML，支持 PDF 打印 |
| 用户管理 | REQ-USER | 3.2.1 | /api/users, Worker /users | 增查删用户 |

## 7 注释

- 背景与用途：本平台用于可靠性分析，覆盖导入、映射、分析、对比、导出、用户管理全流程。  
- 术语与缩略语：MTBF（平均无故障时间）、SDA（场景/路径可靠度近似）、PKR（性能/可靠度对比指标）、DeepSeek（智能列映射外部服务）、Worker（Cloudflare Worker 用户管理）。  
- 公式：前端与导出依赖 MathJax 渲染；打印 PDF 前需确认公式加载正常。    
- 参考：更多上下文可见引用文档（需求、测试、设计、手册等）。
