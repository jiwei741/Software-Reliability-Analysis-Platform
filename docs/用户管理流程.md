# 用户管理流程（Cloudflare KV 同步版）

适用于当前“系统管理”页面，用户信息存放在 Cloudflare Workers KV。流程涵盖查看、添加、删除。

## 前提配置
- `.env`：`WORKER_ENDPOINT=https://reliability-user-worker.wukong-travel.workers.dev/users`
- 如 Worker 开启鉴权：`WORKER_AUTH_TOKEN=<你的token>`（平台和 Worker 校验需一致）
- 平台后端已暴露 `/api/users`（GET 拉取云端列表，POST 写入），Worker 端实现：
  - `POST /users` 保存记录，返回 `data` 含 `id`
  - `GET /users` 列出 KV 中所有记录（含 `id`）
  - `DELETE /users/:id` 删除指定记录（`id` 可为 uuid 或 `user:uuid`）

## 查看（平台 UI）
1. 打开“系统管理”页面，右侧成员列表加载时调用 `/api/users`，实时展示 KV 中已有成员。

## 添加（平台 UI）
1. 在左侧“快速创建用户”表单填写姓名、角色、邮箱、状态。
2. 点击“添加用户”，前端调用 `/api/users`（POST），后端转发到 Worker。
3. 同步成功后表格追加新成员；失败会提示。

## 删除（管理员手工操作）
当前 UI 未提供删除按钮，管理员可通过命令行直接调用 Worker：

### PowerShell 示例
```powershell
# 查看列表（获取 id）
Invoke-WebRequest -Uri "https://reliability-user-worker.wukong-travel.workers.dev/users"

# 删除，id 可用 uuid（推荐）或 user:uuid
$id = "632f6aff-857b-4832-b599-d6eaf6a2e5e1"
Invoke-WebRequest -Uri "https://reliability-user-worker.wukong-travel.workers.dev/users/$id" -Method Delete
```

### curl.exe 示例
```bash
$env:HTTP_PROXY  = "http://127.0.0.1:7890"
$env:HTTPS_PROXY = "http://127.0.0.1:7890"
curl.exe -X GET "https://reliability-user-worker.wukong-travel.workers.dev/users"
curl.exe -X DELETE "https://reliability-user-worker.wukong-travel.workers.dev/users/632f6aff-857b-4832-b599-d6eaf6a2e5e1"
```

（如 Worker 开启鉴权，请在请求头添加 `Authorization: Bearer <token>`）

## 后续可选改进
- 在“成员列表”表格中增加“删除”按钮，调用平台新增的 `/api/users/<id>` DELETE 代理接口，再同步刷新列表。
- 为删除操作添加二次确认和操作审计记录。
